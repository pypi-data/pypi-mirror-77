(window["webpackJsonp_jupyterlab_application_top"]=window["webpackJsonp_jupyterlab_application_top"]||[]).push([[2748],{xwX5:(e,t,i)=>{"use strict";i.r(t);i.d(t,{DSVModel:()=>h,parseDSV:()=>a,parseDSVNoQuotes:()=>l,CSVDelimiter:()=>O,CSVDocumentWidget:()=>q,CSVViewer:()=>k,CSVViewerFactory:()=>F,GridSearchService:()=>S,TSVViewerFactory:()=>$,TextRenderConfig:()=>R});var s=i("okQW");var r=i("l37l");var n;(function(e){e[e["QUOTED_FIELD"]=0]="QUOTED_FIELD";e[e["QUOTED_FIELD_QUOTE"]=1]="QUOTED_FIELD_QUOTE";e[e["UNQUOTED_FIELD"]=2]="UNQUOTED_FIELD";e[e["NEW_FIELD"]=3]="NEW_FIELD";e[e["NEW_ROW"]=4]="NEW_ROW"})(n||(n={}));var o;(function(e){e[e["CR"]=0]="CR";e[e["CRLF"]=1]="CRLF";e[e["LF"]=2]="LF"})(o||(o={}));function a(e){const{data:t,columnOffsets:i,delimiter:s=",",startIndex:r=0,maxRows:a=4294967295,rowDelimiter:l="\r\n",quote:d='"'}=e;let h=e.ncols;let c=0;const u=[];const _=s.charCodeAt(0);const f=d.charCodeAt(0);const m=10;const w=13;const g=t.length;const{QUOTED_FIELD:p,QUOTED_FIELD_QUOTE:C,UNQUOTED_FIELD:y,NEW_FIELD:O,NEW_ROW:b}=n;const{CR:x,LF:D,CRLF:v}=o;const[E,R]=l==="\r\n"?[v,2]:l==="\r"?[x,1]:[D,1];let S=b;let k=r;let q=0;let P;while(k<g){if(S===b){u.push(k);q=1}P=t.charCodeAt(k);switch(S){case b:case O:switch(P){case f:S=p;break;case _:S=O;break;case w:if(E===x){S=b}else if(E===v&&t.charCodeAt(k+1)===m){k++;S=b}else{throw`string index ${k} (in row ${c}, column ${q}): carriage return found, but not as part of a row delimiter C ${t.charCodeAt(k+1)}`}break;case m:if(E===D){S=b}else{throw`string index ${k} (in row ${c}, column ${q}): line feed found, but row delimiter starts with a carriage return`}break;default:S=y;break}break;case p:k=t.indexOf(d,k);if(k<0){throw`string index ${k} (in row ${c}, column ${q}): mismatched quote`}S=C;break;case C:switch(P){case f:S=p;break;case _:S=O;break;case w:if(E===x){S=b}else if(E===v&&t.charCodeAt(k+1)===m){k++;S=b}else{throw`string index ${k} (in row ${c}, column ${q}): carriage return found, but not as part of a row delimiter C ${t.charCodeAt(k+1)}`}break;case m:if(E===D){S=b}else{throw`string index ${k} (in row ${c}, column ${q}): line feed found, but row delimiter starts with a carriage return`}break;default:throw`string index ${k} (in row ${c}, column ${q}): quote in escaped field not followed by quote, delimiter, or row delimiter`}break;case y:while(k<g){P=t.charCodeAt(k);if(P===_||P===m||P===w){break}k++}switch(P){case _:S=O;break;case w:if(E===x){S=b}else if(E===v&&t.charCodeAt(k+1)===m){k++;S=b}else{throw`string index ${k} (in row ${c}, column ${q}): carriage return found, but not as part of a row delimiter C ${t.charCodeAt(k+1)}`}break;case m:if(E===D){S=b}else{throw`string index ${k} (in row ${c}, column ${q}): line feed found, but row delimiter starts with a carriage return`}break;default:continue}break;default:throw`string index ${k} (in row ${c}, column ${q}): state not recognized`}k++;switch(S){case b:c++;if(h===undefined){if(c!==1){throw new Error("Error parsing default number of columns")}h=q}if(i===true){if(q<h){for(;q<h;q++){u.push(k-R)}}else if(q>h){u.length=u.length-(q-h)}}if(c===a){return{nrows:c,ncols:i?h:0,offsets:u}}break;case O:if(i===true){u.push(k)}q++;break;default:break}}if(S!==b){c++;if(i===true){if(h===undefined){h=q}if(q<h){for(;q<h;q++){u.push(k-(R-1))}}else if(q>h){u.length=u.length-(q-h)}}}return{nrows:c,ncols:i?h!==null&&h!==void 0?h:0:0,offsets:u}}function l(e){const{data:t,columnOffsets:i,delimiter:s=",",rowDelimiter:r="\r\n",startIndex:n=0,maxRows:o=4294967295}=e;let a=e.ncols;const l=[];let d=0;const h=r.length;let c=n;const u=t.length;let _;let f;let m;let w;let g;_=n;while(_!==-1&&d<o&&c<u){l.push(c);d++;_=t.indexOf(r,c);g=_===-1?u:_;if(i===true){f=1;m=t.slice(c,g);w=m.indexOf(s);if(a===undefined){while(w!==-1){l.push(c+w+1);f++;w=m.indexOf(s,w+1)}a=f}else{while(w!==-1&&f<a){l.push(c+w+1);f++;w=m.indexOf(s,w+1)}while(f<a){l.push(g);f++}}}c=g+h}return{nrows:d,ncols:i?a!==null&&a!==void 0?a:0:0,offsets:l}}const d={quotes:a,noquotes:l};class h extends s.DataModel{constructor(e){super();this._rowCount=1;this._header=[];this._columnOffsets=new Uint32Array(0);this._columnOffsetsStartingRow=0;this._maxCacheGet=1e3;this._rowOffsets=new Uint32Array(1);this._delayedParse=null;this._startedParsing=false;this._doneParsing=false;this._isDisposed=false;this._ready=new r.PromiseDelegate;let{data:t,delimiter:i=",",rowDelimiter:s=undefined,quote:n='"',quoteParser:o=undefined,header:a=true,initialRows:l=500}=e;this._data=t;this._delimiter=i;this._quote=n;this._quoteEscaped=new RegExp(n+n,"g");this._initialRows=l;if(s===undefined){const e=t.slice(0,5e3).indexOf("\r");if(e===-1){s="\n"}else if(t[e+1]==="\n"){s="\r\n"}else{s="\r"}}this._rowDelimiter=s;if(o===undefined){o=t.indexOf(n)>=0}this._parser=o?"quotes":"noquotes";this._parseAsync();if(a===true&&this._columnCount>0){const e=[];for(let t=0;t<this._columnCount;t++){e.push(this._getField(0,t))}this._header=e}}get isDisposed(){return this._isDisposed}get ready(){return this._ready.promise}rowCount(e){if(e==="body"){if(this._header.length===0){return this._rowCount}else{return this._rowCount-1}}return 1}columnCount(e){if(e==="body"){return this._columnCount}return 1}data(e,t,i){let s;switch(e){case"body":if(this._header.length===0){s=this._getField(t,i)}else{s=this._getField(t+1,i)}break;case"column-header":if(this._header.length===0){s=(i+1).toString()}else{s=this._header[i]}break;case"row-header":s=(t+1).toString();break;case"corner-header":s="";break;default:throw"unreachable"}return s}dispose(){if(this._isDisposed){return}this._isDisposed=true;this._columnCount=undefined;this._rowCount=undefined;this._rowOffsets=null;this._columnOffsets=null;this._data=null;if(this._doneParsing===false){this.ready.catch(()=>{});this._ready.reject(undefined)}if(this._delayedParse!==null){window.clearTimeout(this._delayedParse)}}_computeRowOffsets(e=4294967295){if(this._rowCount>=e||this._doneParsing===true){return}if(this._columnCount===undefined){this._columnCount=d[this._parser]({data:this._data,delimiter:this._delimiter,rowDelimiter:this._rowDelimiter,quote:this._quote,columnOffsets:true,maxRows:1}).ncols}const{nrows:t,offsets:i}=d[this._parser]({data:this._data,startIndex:this._rowOffsets[this._rowCount-1],delimiter:this._delimiter,rowDelimiter:this._rowDelimiter,quote:this._quote,columnOffsets:false,maxRows:e-this._rowCount+1});if(this._startedParsing&&t<=1){this._doneParsing=true;this._ready.resolve(undefined);return}this._startedParsing=true;const s=this._rowCount;this._rowCount=s+t-1;if(this._rowCount<e){this._doneParsing=true;this._ready.resolve(undefined)}const r=this._rowOffsets;this._rowOffsets=new Uint32Array(this._rowCount);this._rowOffsets.set(r);this._rowOffsets.set(i,s-1);const n=Math.floor(33554432/this._columnCount);if(s<=n){if(this._rowCount<=n){const e=this._columnOffsets;this._columnOffsets=new Uint32Array(this._rowCount*this._columnCount);this._columnOffsets.set(e);this._columnOffsets.fill(4294967295,e.length)}else{const e=this._columnOffsets;this._columnOffsets=new Uint32Array(Math.min(this._maxCacheGet,n)*this._columnCount);this._columnOffsets.set(e.subarray(0,this._columnOffsets.length));this._columnOffsets.fill(4294967295,e.length);this._columnOffsetsStartingRow=0}}let o=s;if(this._header.length>0){o-=1}this.emitChanged({type:"rows-inserted",region:"body",index:o,span:this._rowCount-s})}_getField(e,t){let i;let s;const r=this._getOffsetIndex(e,t);let n=0;let o=0;if(t===this._columnCount-1){if(e<this._rowCount-1){s=this._getOffsetIndex(e+1,0);n+=this._rowDelimiter.length}else{s=this._data.length;if(this._data[s-1]===this._rowDelimiter[this._rowDelimiter.length-1]){n+=this._rowDelimiter.length}}}else{s=this._getOffsetIndex(e,t+1);if(r<s&&this._data[s-1]===this._delimiter){n+=1}}if(this._data[r]===this._quote){o+=1;n+=1}i=this._data.slice(r+o,s-n);if(o===1&&i.indexOf(this._quote)!==-1){i=i.replace(this._quoteEscaped,this._quote)}return i}_getOffsetIndex(e,t){const i=this._columnCount;let s=(e-this._columnOffsetsStartingRow)*i;if(s<0||s>this._columnOffsets.length){this._columnOffsets.fill(4294967295);this._columnOffsetsStartingRow=e;s=0}if(this._columnOffsets[s]===4294967295){let t=1;while(t<=this._maxCacheGet&&this._columnOffsets[s+t*i]===16777215){t++}const{offsets:r}=d[this._parser]({data:this._data,delimiter:this._delimiter,rowDelimiter:this._rowDelimiter,quote:this._quote,columnOffsets:true,maxRows:t,ncols:i,startIndex:this._rowOffsets[e]});for(let e=0;e<r.length;e++){this._columnOffsets[s+e]=r[e]}}return this._columnOffsets[s+t]}_parseAsync(){let e=this._initialRows;let t=Math.pow(2,32)-1;const i=30;const s=e=>{try{this._computeRowOffsets(e)}catch(t){if(this._parser==="quotes"){console.warn(t);this._parser="noquotes";this._resetParser();this._computeRowOffsets(e)}else{throw t}}return this._doneParsing};this._resetParser();const r=s(e);if(r){return}const n=()=>{const r=s(e+t);e+=t;if(t<1e6){t*=2}if(r){this._delayedParse=null}else{this._delayedParse=window.setTimeout(n,i)}};this._delayedParse=window.setTimeout(n,i)}_resetParser(){this._columnCount=undefined;this._rowOffsets=new Uint32Array(1);this._rowCount=1;this._startedParsing=false;this._columnOffsets=new Uint32Array(0);if(this._doneParsing===false){this.ready.catch(()=>{});this._ready.reject(undefined)}this._doneParsing=false;this._ready=new r.PromiseDelegate;if(this._delayedParse!==null){window.clearTimeout(this._delayedParse);this._delayedParse=null}this.emitChanged({type:"model-reset"})}}var c=i("8YcT");var u=i("3gBK");var _=i("4L4Y");var f=i("s/A5");var m=i("aV2H");var w=i("MWqd");var g=i("VzLA");const p="jp-CSVDelimiter";const C="jp-CSVDelimiter-label";const y="jp-CSVDelimiter-dropdown";class O extends m.Widget{constructor(e){super({node:b.createNode(e.selected,e.translator)});this._delimiterChanged=new f.Signal(this);this.addClass(p)}get delimiterChanged(){return this._delimiterChanged}get selectNode(){return this.node.getElementsByTagName("select")[0]}handleEvent(e){switch(e.type){case"change":this._delimiterChanged.emit(this.selectNode.value);break;default:break}}onAfterAttach(e){this.selectNode.addEventListener("change",this)}onBeforeDetach(e){this.selectNode.removeEventListener("change",this)}}var b;(function(e){function t(e,t){t=t||g.nullTranslator;const i=t===null||t===void 0?void 0:t.load("jupyterlab");const s=[[",",","],[";",";"],["\t",i.__("tab")],["|",i.__("pipe")],["#",i.__("hash")]];const r=document.createElement("div");const n=document.createElement("span");const o=document.createElement("select");n.textContent=i.__("Delimiter: ");n.className=C;(0,u.each)(s,([t,i])=>{const s=document.createElement("option");s.value=t;s.textContent=i;if(t===e){s.selected=true}o.appendChild(s)});r.appendChild(n);const a=w.Styling.wrapSelect(o);a.classList.add(y);r.appendChild(a);return r}e.createNode=t})(b||(b={}));var x=undefined&&undefined.__rest||function(e,t){var i={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0)i[s]=e[s];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,s=Object.getOwnPropertySymbols(e);r<s.length;r++){if(t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r]))i[s[r]]=e[s[r]]}return i};const D="jp-CSVViewer";const v="jp-CSVViewer-grid";const E=1e3;class R{}class S{constructor(e){this._looping=true;this._changed=new f.Signal(this);this._grid=e;this._query=null;this._row=0;this._column=-1}get changed(){return this._changed}cellBackgroundColorRendererFunc(e){return({value:t,row:i,column:s})=>{if(this._query){if(t.match(this._query)){if(this._row===i&&this._column===s){return e.currentMatchBackgroundColor}return e.matchBackgroundColor}}return""}}clear(){this._query=null;this._row=0;this._column=-1;this._changed.emit(undefined)}find(e,t=false){const i=this._grid.dataModel;const s=i.rowCount("body");const r=i.columnCount("body");if(this._query!==e){this._row=0;this._column=-1}this._query=e;const n=this._grid.scrollY/this._grid.defaultSizes.rowHeight;const o=(this._grid.scrollY+this._grid.pageHeight)/this._grid.defaultSizes.rowHeight;const a=this._grid.scrollX/this._grid.defaultSizes.columnHeaderHeight;const l=(this._grid.scrollX+this._grid.pageWidth)/this._grid.defaultSizes.columnHeaderHeight;const d=(e,t)=>e>=n&&e<=o&&t>=a&&t<=l;const h=t?-1:1;this._column+=h;for(let c=this._row;t?c>=0:c<s;c+=h){for(let s=this._column;t?s>=0:s<r;s+=h){const t=i.data("body",c,s);if(t.match(e)){this._changed.emit(undefined);if(!d(c,s)){this._grid.scrollToRow(c)}this._row=c;this._column=s;return true}}this._column=t?r-1:0}if(this._looping){this._looping=false;this._row=t?0:s-1;this._wrapRows(t);try{return this.find(e,t)}finally{this._looping=true}}return false}_wrapRows(e=false){const t=this._grid.dataModel;const i=t.rowCount("body");const s=t.columnCount("body");if(e&&this._row<=0){this._row=i-1;this._column=s}else if(!e&&this._row>=i-1){this._row=0;this._column=-1}}get query(){return this._query}}class k extends m.Widget{constructor(e){super();this._monitor=null;this._delimiter=",";this._revealed=new r.PromiseDelegate;this._baseRenderer=null;const t=this._context=e.context;const i=this.layout=new m.PanelLayout;this.addClass(D);this._grid=new s.DataGrid({defaultSizes:{rowHeight:24,columnWidth:144,rowHeaderWidth:64,columnHeaderHeight:36}});this._grid.addClass(v);this._grid.headerVisibility="all";this._grid.keyHandler=new s.BasicKeyHandler;this._grid.mouseHandler=new s.BasicMouseHandler;this._grid.copyConfig={separator:"\t",format:s.DataGrid.copyFormatGeneric,headers:"all",warningThreshold:1e6};i.addWidget(this._grid);this._searchService=new S(this._grid);this._searchService.changed.connect(this._updateRenderer,this);void this._context.ready.then(()=>{this._updateGrid();this._revealed.resolve(undefined);this._monitor=new c.ActivityMonitor({signal:t.model.contentChanged,timeout:E});this._monitor.activityStopped.connect(this._updateGrid,this)})}get context(){return this._context}get revealed(){return this._revealed.promise}get delimiter(){return this._delimiter}set delimiter(e){if(e===this._delimiter){return}this._delimiter=e;this._updateGrid()}get style(){return this._grid.style}set style(e){this._grid.style=e}set rendererConfig(e){this._baseRenderer=e;this._updateRenderer()}get searchService(){return this._searchService}dispose(){if(this._monitor){this._monitor.dispose()}super.dispose()}goToLine(e){this._grid.scrollToRow(e)}onActivateRequest(e){this.node.tabIndex=-1;this.node.focus()}_updateGrid(){const e=this._context.model.toString();const t=this._delimiter;const i=this._grid.dataModel;const r=this._grid.dataModel=new h({data:e,delimiter:t});this._grid.selectionModel=new s.BasicSelectionModel({dataModel:r});if(i){i.dispose()}}_updateRenderer(){if(this._baseRenderer===null){return}const e=this._baseRenderer;const t=new s.TextRenderer({textColor:e.textColor,horizontalAlignment:e.horizontalAlignment,backgroundColor:this._searchService.cellBackgroundColorRendererFunc(e)});this._grid.cellRenderers.update({body:t,"column-header":t,"corner-header":t,"row-header":t})}}class q extends _.DocumentWidget{constructor(e){let{content:t,context:i,delimiter:s,reveal:r}=e,n=x(e,["content","context","delimiter","reveal"]);t=t||P.createContent(i);r=Promise.all([r,t.revealed]);super(Object.assign({content:t,context:i,reveal:r},n));if(s){t.delimiter=s}const o=new O({selected:t.delimiter});this.toolbar.addItem("delimiter",o);o.delimiterChanged.connect((e,i)=>{t.delimiter=i})}setFragment(e){const t=e.split("=");if(t[0]!=="#row"){return}let i=t[1].split(";")[0];i=i.split("-")[0];void this.context.ready.then(()=>{this.content.goToLine(Number(i))})}}var P;(function(e){function t(e){return new k({context:e})}e.createContent=t})(P||(P={}));class F extends _.ABCWidgetFactory{createNewWidget(e){const t=this.translator;return new q({context:e,translator:t})}}class $ extends _.ABCWidgetFactory{createNewWidget(e){const t="\t";return new q({context:e,delimiter:t,translator:this.translator})}}}}]);