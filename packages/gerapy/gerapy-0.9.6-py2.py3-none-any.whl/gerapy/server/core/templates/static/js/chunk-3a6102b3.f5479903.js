(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a6102b3"],{6906:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"panel"},[s("panel-title",{attrs:{title:t.$lang.titles.deployProject}}),s("div",{staticClass:"panel-body"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],style:{width:"100%"},attrs:{data:t.clients,"element-loading-text":t.$lang.messages.loading},on:{"selection-change":t.onBatchSelect}},[s("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),s("el-table-column",{attrs:{align:"center",label:t.$lang.columns.status,width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:t.statusClass[t.clientsStatus[e.row.pk]],size:"mini"}},[t._v("\n\t\t\t\t\t\t\t\t\t\t"+t._s(t.statusText[t.clientsStatus[e.row.pk]])+"\n\t\t\t\t\t\t\t\t\t")])]}}])}),s("el-table-column",{attrs:{align:"center",prop:"pk",label:t.$lang.columns.id,width:"60"}}),s("el-table-column",{attrs:{align:"center",prop:"fields.name",label:t.$lang.columns.name,width:"100"}}),s("el-table-column",{attrs:{align:"center",prop:"fields.ip",label:t.$lang.columns.ip,width:"150"}}),s("el-table-column",{attrs:{align:"center",prop:"fields.port",label:t.$lang.columns.port,width:"100"}}),s("el-table-column",{attrs:{align:"center",label:t.$lang.columns.description},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(t.projectDescriptions[e.row.pk]))])]}}])}),s("el-table-column",{attrs:{align:"center",label:t.$lang.columns.deployedAt},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(t.projectDateTimes[e.row.pk]))])]}}])}),s("el-table-column",{attrs:{align:"center",label:t.$lang.columns.operations},scopedSlots:t._u([{key:"default",fn:function(e){return[t.clientsStatus[e.row.pk]?s("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(s){return t.onDeploy(e.row.pk)}}},[s("i",{staticClass:"fa fa-cloud-upload"}),t._v("\n\t\t\t\t\t\t\t\t\t\t"+t._s(t.$lang.buttons.deploy)+"\n\t\t\t\t\t\t\t\t\t")]):t._e()]}}])})],1),s("bottom-bar",{scopedSlots:t._u([{key:"handler",fn:function(e){return s("el-button",{attrs:{type:"primary",size:"mini",disabled:0===t.batchSelect.length},on:{click:t.onBatchDeploy}},[s("span",[s("i",{staticClass:"fa fa-cloud-upload"}),t._v("\n\t\t\t\t\t\t\t\t\t\t"+t._s(t.$lang.buttons.batchDeploy)+"\n\t\t\t\t\t\t\t\t\t")])])}}])})],1)],1)])],1),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("div",{staticClass:"panel"},[s("panel-title",{attrs:{title:t.$lang.objects.project}}),s("div",{staticClass:"panel-body"},[s("el-form",{attrs:{model:t.buildInfo,"label-width":"120px"}},[s("el-form-item",{attrs:{label:t.$lang.columns.name}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.buildInfo.name)+"\n\t\t\t\t\t\t\t")]),s("el-form-item",{attrs:{label:t.$lang.columns.packageName}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.buildInfo.egg||t.notBuildText)+"\n\t\t\t\t\t\t\t")]),s("el-form-item",{attrs:{label:t.$lang.columns.builtAt}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.buildInfo.built_at||t.notBuildText)+"\n\t\t\t\t\t\t\t")])],1)],1)],1)]),s("el-col",{attrs:{span:12}},[s("div",{staticClass:"panel"},[s("panel-title",{attrs:{title:t.$lang.titles.buildProject}}),s("div",{staticClass:"panel-body"},[s("el-form",{ref:"form",attrs:{model:t.buildInfo,rules:t.rules,"label-width":"120px"}},[s("el-form-item",{attrs:{label:t.$lang.columns.name}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.buildInfo.name)+"\n\t\t\t\t\t\t\t")]),s("el-form-item",{staticClass:"description",attrs:{label:t.$lang.columns.description,prop:"description"}},[s("el-input",{attrs:{size:"small"},model:{value:t.buildInfo.description,callback:function(e){t.$set(t.buildInfo,"description",e)},expression:"buildInfo.description"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.onBuild}},[s("i",{staticClass:"fa fa-codepen"}),t.buildInfo.egg?s("span",[t._v(" "+t._s(t.$lang.buttons.re))]):t._e(),t._v(t._s(t.$lang.buttons.build)+"\n\t\t\t\t\t\t\t\t")])],1)],1)],1)],1)])],1)],1)},l=[],a=(s("ac6a"),s("7f7f"),s("eee4")),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bottom-toolbar ofh"},[s("el-row",[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"fl"},[t._t("handler")],2),s("div",{staticClass:"fr"},[t._t("page")],2)])],1)],1)},o=[],r={name:"BottomBar"},c=r,u=s("2877"),g=Object(u["a"])(c,i,o,!1,null,null,null),d=g.exports,p={data:function(){return{buildInfo:{},notBuildText:this.$store.getters.$lang.messages.notBuilt,clients:[],loading:!1,projectName:this.$route.params.name,batchSelect:[],projectDescriptions:{},projectDateTimes:{},clientsStatus:{},statusClass:{1:"success",0:"warning","-1":"danger"},statusText:{1:this.$store.getters.$lang.buttons.normal,0:this.$store.getters.$lang.buttons.connecting,"-1":this.$store.getters.$lang.buttons.error},rules:{description:[{required:!0,message:this.$store.getters.$lang.messages.emptyDescription,trigger:"blur"}]}}},components:{PanelTitle:a["a"],BottomBar:d},created:function(){this.getClientData(),this.getBuildInfo()},methods:{onBatchSelect:function(t){this.batchSelect=t,console.log(this.batchSelect)},getBuildInfo:function(){var t=this;this.loading=!0,this.$http.get(this.formatString(this.$store.state.url.project.build,{name:this.projectName})).then(function(e){var s=e.data;t.buildInfo=s,console.log(s),t.loading=!1}).catch(function(){t.loading=!1})},getClientStatus:function(t){var e=this;this.$set(this.clientsStatus,t,0),this.$http.get(this.formatString(this.$store.state.url.client.status,{id:t})).then(function(s){var n=s.data.result;e.$set(e.clientsStatus,t,n)}).catch(function(){e.$set(e.clientsStatus,t,-1)})},getClientData:function(){var t=this;this.loading=!0,this.$http.get(this.$store.state.url.client.index).then(function(e){var s=e.data;t.clients=s,t.loading=!1,t.clients.forEach(function(e){var s=e.pk;t.getProjectVersion(s),t.getClientStatus(s)})}).catch(function(){t.loading=!1})},deploy:function(t){var e=this;this.clientsStatus[t]?this.$http.post(this.formatString(this.$store.state.url.client.projectDeploy,{id:t,name:this.projectName})).then(function(){e.$message.success(e.$store.getters.$lang.titles.client+" "+t+" "+e.$store.getters.$lang.messages.successDeploy),e.getProjectVersion(t),e.loading=!1}).catch(function(){e.$message.error(e.$store.getters.$lang.titles.client+" "+t+" "+e.$store.getters.$lang.messages.errorDeploy),e.loading=!1}):(this.$message.error(this.$store.getters.$lang.titles.client+" "+t+" "+this.$store.getters.$lang.messages.errorDeploy),this.loading=!1)},getProjectVersion:function(t){var e=this;this.loading=!0,this.$http.get(this.formatString(this.$store.state.url.client.projectVersion,{id:t,name:this.projectName})).then(function(s){var n=s.data;e.$set(e.projectDescriptions,t,n["description"]),e.$set(e.projectDateTimes,t,n["deployed_at"]),e.loading=!1}).catch(function(){e.loading=!1})},onBatchDeploy:function(){var t=this;this.$confirm(this.$store.getters.$lang.messages.confirm,this.$store.getters.$lang.buttons.confirm,{confirmButtonText:this.$store.getters.$lang.buttons.yes,cancelButtonText:this.$store.getters.$lang.buttons.no,type:"warning"}).then(function(){t.loading=!0,console.log(t.batchSelect),t.batchSelect.forEach(function(e){var s=e.pk;t.deploy(s)})}).catch(function(){t.$message.error(t.$store.getters.$lang.messages.errorDeploy)})},onDeploy:function(t){this.buildInfo.egg?this.deploy(t):this.$message.error(this.$store.getters.$lang.messages.buildFirst)},onBuild:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.$http.post(t.formatString(t.$store.state.url.project.build,{name:t.projectName}),{description:t.buildInfo["description"],egg:t.buildInfo["egg"],built_at:t.buildInfo["built_at"]}).then(function(e){var s=e.data;t.buildInfo=s,console.log(s),t.loading=!1,t.$message.success(t.$store.getters.$lang.messages.successBuild)}).catch(function(){t.loading=!1,t.$message.error(t.$store.getters.$lang.messages.errorBuild)})})}}},f=p,m=(s("f1f2"),Object(u["a"])(f,n,l,!1,null,null,null));e["default"]=m.exports},eee4:function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"panel-title"},[t.title?s("span",{domProps:{textContent:t._s(t.title)}}):t._e(),s("div",{staticClass:"fr"},[t._t("default")],2)])},l=[],a={name:"PanelTitle",props:{title:{type:String}}},i=a,o=s("2877"),r=Object(o["a"])(i,n,l,!1,null,null,null);e["a"]=r.exports},f1f2:function(t,e,s){"use strict";var n=s("fcb3"),l=s.n(n);l.a},fcb3:function(t,e,s){}}]);
//# sourceMappingURL=chunk-3a6102b3.f5479903.js.map